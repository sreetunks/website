{{- $params := site.Params.upvote -}}
{{- if not ($params.enabled | default false) -}}
{{-   return -}}
{{- end -}}
{{- $slug := strings.TrimSuffix "/" .RelPermalink -}}
{{- /* Share upvote across translations by using a canonical slug without the current language prefix. */ -}}
{{- $langPrefix := .Site.LanguagePrefix -}}
{{- if and $langPrefix (ne $langPrefix "/") (strings.HasPrefix $slug $langPrefix) -}}
  {{- $slug = strings.TrimPrefix $langPrefix $slug -}}
{{- end -}}
{{- if not $slug -}}
{{-   return -}}
{{- end -}}
{{- $endpoint := or $params.endpoint "/api/upvote" -}}
{{- $info := or $params.infoEndpoint "/api/upvote-info" -}}
{{- $title := .Title | default "" -}}
{{- $idSafe := strings.Replace (strings.TrimPrefix "/" $slug) "/" "-" -1 -}}
{{- $formId := printf "upvote-form-%s" $idSafe -}}
<div class="upvote-widget" data-upvote data-slug="{{ $slug }}" data-endpoint="{{ $endpoint }}" data-info-endpoint="{{ $info }}" data-hint="{{ i18n "upvote_hint" }}" data-upvoted-title="{{ i18n "upvoted_title" }}">
  <form id="{{ $formId }}" action="{{ $endpoint }}" method="post" style="display: inline">
    <small>
      <input hidden name="slug" value="{{ $slug }}" style="display:none">
      <input hidden name="title" value="{{ $title }}" style="display:none">
      <input hidden name="permalink" value="{{ .RelPermalink }}" style="display:none">
      <input hidden name="dateISO" value="{{ .Date.Format "2006-01-02" }}" style="display:none">

      <button class="upvote-button" type="submit" title="{{ i18n "upvote_title" }}">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <polyline points="17 11 12 6 7 11"></polyline>
          <polyline points="17 18 12 13 7 18"></polyline>
        </svg>
        <small class="upvote-count">&nbsp;</small>
      </button>
    </small>
  </form>
</div>
